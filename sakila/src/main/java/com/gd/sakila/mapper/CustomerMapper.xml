<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gd.sakila.mapper.CustomerMapper">
	<!-- 고객 목록 -->
	<select id="selectCustomerList"
			parameterType="java.util.Map"
			resultType="com.gd.sakila.vo.CustomerList">
		SELECT
			ID,
			name,
			address,
			`zip code` zipCode,
			phone,
			city,
			country,
			notes,
			SID
		FROM customer_list
		<where> <!-- 쿼리에서의 where 태그를 대신함 -->
			<if test="searchWord != null">
				name LIKE CONCAT('%',#{searchWord},'%')
			</if>
		</where>
		ORDER BY ID ASC
		LIMIT #{beginRow}, #{rowPerPage}
		<!-- 페이징, 검색 기능 추가 필요함 -->
	</select>
	
	<!-- 고객 데이터 개수 세기 (페이징에 필요함) -->
	<select id="selectCustomerTotal" resultType="Integer" parameterType="String">
		SELECT COUNT(*) FROM customer_list
		<where>
			<if test="searchWord != null">
				name LIKE CONCAT('%',#{searchWord},'%')
			</if>
		</where>
	</select>
	
	<!-- 휴면 고객 처리 쿼리 -->
	<update id="updateCustomerActiveByScheduler">
		UPDATE customer
		SET active = 0
		WHERE customer_id IN (	SELECT customer_id
								FROM rental
								GROUP BY customer_id
								HAVING DATEDIFF(NOW(), MAX(rental_date)) > 365
							)
	</update>
</mapper>